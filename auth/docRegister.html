<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: rgb(255, 225, 225);
        }

        * {
            box-sizing: border-box;
        }

        /* Add padding to containers */

        .containerr {
            padding: 16px;
            background-color: rgb(255, 225, 225);
        }

        /* Full-width input fields */

        input[type=text],
        input[type=password] {
            width: 100%;
            padding: 15px;
            margin: 5px 0 22px 0;
            display: list-block;
            border: none;
            background:white;
        }

        input[type=text]:focus,
        input[type=password]:focus {
            background-color: #ddd;
            outline: none;
        }

        /* Overwrite default styles of hr */

        hr {
            border: 1px solid #f1f1f1;
            margin-bottom: 25px;
        }

        /* Set a style for the submit button */

        .registerbtn {
            background-color: rgb(37, 47, 53);
            color: white;
            padding: 16px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 50%;
            opacity: 0.9;
        }

        .registerbtn:hover {
            opacity: 1;
        }

        /* Add a blue text color to links */

        a {
            color: dodgerblue;
        }

        /* Set a grey background color and center the text of the "sign in" section */

        .signin {
            background-color: #f1f1f1;
            text-align: center;
        }
    </style>
</head>

<body>
    <div style="margin-top: 20px;margin-left: 20px;">
        <input type="search" placeholder="search for Upldate or Delete" id="search">
        <button id="searchbtn" type="button">search</button>
    </div>
<form>
    <div class="containerr">
        <h1 style="text-align:center; color: #818181;">Doctors Registration</h1>

        <p>Please fill in this form to create an account.</p>

        <label for="text"><b>NIC</b></label>
        <input type="text" placeholder="Enter NIC" name="nic" id="nic" required>

        <label><b>First Name</b></label>
        <input type="text" placeholder="First Name" name="fName" id="fName" required>

        <label><b>Last Name</b></label>
        <input type="text" placeholder="Last Name" name="lName" id="lName" required>

        <label><b>Province</b></label>
        <select name="pName" id="pName"  class="form-select">
            <option value="Western">Western</option>
            <option value="Southern">Southern</option>
            <option value="Central">Central</option>
            <option value="Northern">Northern</option>
            <option value="Uva">Uva</option>
            <option value="North Western">North Western</option>
            <option value="North Central">North Central</option>
            <option value="Sabaragamuwa">Sabaragamuwa</option>
            <option value="Eastern">Eastern</option>
        </select>
        
        <label><b>City</b></label>
        <select name="cName" id="cName"  class="form-select">
            <option value="Colombo">Colombo</option>
            <option value="Gampaha">Gampaha</option>
            <option value="Kaluthara">Kaluthara</option>
            <option value="Galle">Galle</option>
            <option value="Matara">Matara</option>
            <option value="Hambantota">Hambantota</option>
            <option value="Kandy">Kandy</option>
            <option value="Matale">Matale</option>
            <option value="Nuwara Eliya">Nuwara Eliya</option>
            <option value="Jaffna">Jaffna</option>
            <option value="Kilinochchi">Kilinochchi</option>
            <option value="Mannar">Mannar</option>
            <option value="Mullaitivu">Mullaitivu</option>
            <option value="Vavuniya">Vavuniya</option>
            <option value="Badulla">Badulla</option>
            <option value="Monaragala">Monaragala</option>
            <option value="Kurunegala">Kurunegala</option>
            <option value="Puttalam">Puttalam</option>
            <option value="Anuradhapura">Anuradhapura</option>
            <option value="Polonnaruwa">Polonnaruwa</option>
            <option value="Kegalle">Kegalle</option>
            <option value="Rathnapura">Rathnapura</option>
            <option value="Ampara">Ampara</option>
            <option value="Batticaloa">Batticaloa</option>
            <option value="Trincomalee">Trincomalee</option>
        </select>
        <label><b>Address</b></label>
        <input type="text" placeholder="Address" name="address" id="address" required>

        <label><b>SLMC Reg Number</b></label>
        <input type="text" placeholder="SLMC Reg Number" name="slmc" id="slmc" required>

        <label><b>Contact Number</b></label>
        <input type="text" placeholder="Contact Number" name="tel" id="tel" required>

        <label><b>Email</b></label>
        <input type="text" placeholder="Email" name="email" id="email" required>

        <label><b>Password</b></label>
        <input type="password" placeholder="Password" name="psw" id="psw" required>

        <hr>
        
        <button type="button" id="submitData" name="submitData" class="registerbtn">Register User</button>
        <button type="button" id="updatebtn" name="updatebtn" class="registerbtn">Update User</button>
        <button type="button" id="deletebtn" name="deletebtn" class="registerbtn">Delete User</button>


    </div>

</form>
</body>
</html>




<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
    import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        deleteUser
    } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js";
    import {getDatabase, set, ref, child, update, get,
            query, orderByChild, equalTo, remove} from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";
    


    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        // Your configs
        apiKey: "AIzaSyBzzFbIdtEvJbITERI0Z8z1fxVlGNxdDLs",
  authDomain: "patientreg-990f5.firebaseapp.com",
  projectId: "patientreg-990f5",
  storageBucket: "patientreg-990f5.appspot.com",
  messagingSenderId: "1010672762357",
  appId: "1:1010672762357:web:20db3eac86471c37b574bc"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);
    var updateId;
    submitData.addEventListener('click', (e) => {
        

        var email = document.getElementById('email').value;
        var password = document.getElementById('psw').value;
        var nic = document.getElementById('nic').value;
        var fName = document.getElementById('fName').value;
        var lName = document.getElementById('lName').value;
        var pName = document.getElementById('pName').value;
        var cName = document.getElementById('cName').value;
        var address = document.getElementById('address').value;
        var tel = document.getElementById('tel').value;
        var slmc = document.getElementById('slmc').value;
        var qr;
        var x;
       
       
    
        //sign up user
        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed in
                var user = userCredential.user;
                // ... user.uid
                set(ref(database, 'doORhospital/' + user.uid), {
                    id: user.uid,
                    email: email,
                    password: password,
                    nic: nic,
                    fName: fName,
                    lName: lName,
                    pName: pName,
                    cName: cName,
                    address: address,
                    tel: tel,
                    slmc: slmc
                })
                    .then(() => {
                        // Data saved successfully!
                        x=user.uid;
                        alert('Doctor Registered successfully');
        
                    })
                    .catch((error) => {
                        // The write failed...
                        alert(error);
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                // ..
                alert(errorMessage);
            });

    });

//........................................................................................
    searchbtn.addEventListener('click', (e) => {

    var i = document.getElementById('search').value;

    const tasksRef = query(ref(database, "doORhospital"), orderByChild("email"), equalTo(i) );
                
                get(tasksRef)
                  .then((snapshot) => {
                    var sti =[];
                    snapshot.forEach(childSnapshot =>{
                      sti.push(childSnapshot.val());
                    });    
                      //const data = snapshot.val();
                      console.log(sti);
                    AddAllUser(sti);
                  })
                  .catch((err) => {
                    console.error(err);
                });
    
    });
    function UserDetails(id,fName,lName,cName,pName,nic,address,tel,slmc,email,){
        updateId=id;
        document.getElementById('nic').value=nic;
        document.getElementById('fName').value=fName;
        document.getElementById('lName').value=lName;
        document.getElementById('pName').value=pName;
        document.getElementById('cName').value=cName;
        document.getElementById('address').value=address;
        document.getElementById('tel').value=tel;
        document.getElementById('slmc').value=slmc;


   }

   function AddAllUser(sti){
      
      sti.forEach(element =>{
      UserDetails(element.id,element.fName,element.lName,element.cName,element.pName,element.nic,element.address,element.tel,element.slmc,element.email)
      });
    }

    updatebtn.addEventListener('click', (e) => {
        var nic = document.getElementById('nic').value;
        var fName = document.getElementById('fName').value;
        var lName = document.getElementById('lName').value;
        var pName = document.getElementById('pName').value;
        var cName = document.getElementById('cName').value;
        var address = document.getElementById('address').value;
        var tel = document.getElementById('tel').value;
        var slmc = document.getElementById('slmc').value;
        update(ref(database, 'doORhospital/' + updateId), {
                    nic: nic,
                    fName: fName,
                    lName: lName,
                    pName: pName,
                    cName: cName,
                    address: address,
                    tel: tel,
                    slmc: slmc
        })
        .then(()=>{
            alert("Updated Successfully");
        })
        .catch((error)=>{
            alert("unsuccessfully: "+error);
        })
    });

    deletebtn.addEventListener('click', (e) => {
        remove(ref(database, 'doORhospital/' + updateId), {

        })
        .then(()=>{
            alert("Deleted Successfully");
        })
        .catch((error)=>{
            alert("unsuccessfully: "+error);
        })

    });
</script>





